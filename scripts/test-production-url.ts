#!/usr/bin/env tsx

async function testProductionURLs() {
  try {
    console.log('ğŸŒ Testing actual production URLs for category filtering...\n')

    const baseUrl = 'https://bonsai-catalog.vercel.app'
    const testCategories = [
      { slug: 'beginner', name: 'ã¯ã˜ã‚ã¦ã®ç›†æ ½' },
      { slug: 'basic-care', name: 'åŸºæœ¬ã®ãŠæ‰‹å…¥ã‚Œ' },
      { slug: 'species', name: 'æ¨¹ç¨®åˆ¥ã‚¬ã‚¤ãƒ‰' }
    ]

    for (const category of testCategories) {
      console.log(`ğŸ§ª Testing category: ${category.name} (${category.slug})`)

      // Test the exact URL that would be generated by the frontend
      const testUrl = `${baseUrl}/guides?category=${category.slug}`
      console.log(`ğŸ“ URL: ${testUrl}`)

      const startTime = Date.now()

      try {
        const response = await fetch(testUrl)
        const endTime = Date.now()
        const duration = endTime - startTime

        if (response.ok) {
          const html = await response.text()

          // Check for key indicators
          const hasNoResults = html.includes('0ä»¶ã®è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ')
          const hasResults = html.match(/(\d+)ä»¶ã®è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ/)
          const articleCount = hasResults ? hasResults[1] : '0'

          // Check for specific article titles we know should exist
          const hasBeginnersGuide = html.includes('åˆå¿ƒè€…å‘ã‘ç›†æ ½ã®å§‹ã‚æ–¹')
          const hasAnyArticleCard = html.includes('article-card') || html.includes('è¨˜äº‹')

          console.log(`  âœ… Status: ${response.status}`)
          console.log(`  â±ï¸  Response time: ${duration}ms`)
          console.log(`  ğŸ“Š Articles shown: ${articleCount}`)
          console.log(`  ğŸ“„ Has article content: ${hasAnyArticleCard ? 'YES' : 'NO'}`)
          console.log(`  ğŸ” Contains known article: ${hasBeginnersGuide ? 'YES' : 'NO'}`)

          if (hasNoResults) {
            console.log(`  âŒ PROBLEM: Shows 0 results`)
          } else if (parseInt(articleCount) > 0) {
            console.log(`  âœ… SUCCESS: Shows ${articleCount} articles`)
          }

        } else {
          console.log(`  âŒ HTTP Error: ${response.status}`)
        }

      } catch (error) {
        console.log(`  âŒ Network Error: ${error}`)
      }

      console.log('')
      await new Promise(resolve => setTimeout(resolve, 1000))
    }

    // Test main guides page without filter
    console.log('ğŸ  Testing main guides page (no filter)...')
    const mainUrl = `${baseUrl}/guides`
    console.log(`ğŸ“ URL: ${mainUrl}`)

    try {
      const response = await fetch(mainUrl)

      if (response.ok) {
        const html = await response.text()
        const hasResults = html.match(/(\d+)ä»¶ã®è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ/)
        const totalCount = hasResults ? hasResults[1] : '0'

        console.log(`  âœ… Total articles on main page: ${totalCount}`)
      }
    } catch (error) {
      console.log(`  âŒ Error: ${error}`)
    }

    console.log('\nğŸ¯ Production URL test completed!')

  } catch (error) {
    console.error('âŒ Production URL test failed:', error)
  }
}

// Run test
testProductionURLs()